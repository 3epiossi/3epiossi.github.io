---
title: 基於IP的WPAN和WLAN
author: NastYboY
date: 2025-06-13
category: IOT
layout: post
mermaid: true
cover: /assets/images/IOT/wifi.webp
---
# TCP/IP
* 普及性：幾乎所有作業系統和傳輸媒介都提供IP堆疊，使其能在各種WPAN系統、蜂巢網路、銅纜、光纖、PCI Express和衛星系統上運作。
* 長壽命：IPv4標準設計於1978年，歷經40年考驗，對於需支援數十年的工業和現場物聯網解決方案至關重要。
* 開放標準：TCP/IP由網際網路工程任務組（IETF）管理，維護著一套開放的網際網路協議標準。
* 可擴展性：IP網路已證明可大規模擴展到數十億用戶和更多設備。IPv6甚至能為地球上的每個原子提供唯一的IP地址。
* 可靠性：IP核心是一個可靠的資料傳輸協議，透過無連接網路的封包傳遞系統實現，並盡力傳遞資料包。
* 管理工具：存在多種用於管理IP網路和設備的工具，如建模工具、網路嗅探器、診斷工具等。
* 傳輸層：IP滿足了對強大網路層的需求，而傳輸層則需要TCP和使用者資料包協議（UDP）。
  * TCP：用於面向連接的傳輸，提供可靠性、分段重排序、流量控制（滑動窗口和擁塞避免演算法），適用於不可靠的IP網路層。
  * UDP：用於無連接的傳輸，實現簡單但缺乏彈性，提供輕量級、高速的資料廣播方法。
* OSI模型：IP協議棧代表了OSI模型中的第三層（網路層）和第四層（傳輸層）。
  * OSI堆疊提供了一個分層協議的參考，每層都在上一層資料包的基礎上添加包頭和包尾。
* IT/OT整合：在物聯網中，將IP接近資料源可以橋接資訊技術（IT）和操作技術（OT）兩個世界，儘管傳統上這兩個角色是分開的。

# IEEE 802.11協議和WLAN
* IEEE 802.11技術是無線區域網路（WLAN）的基礎，通常稱為Wi-Fi™，並廣泛應用於物聯網部署，尤其是在智慧感測器和閘道集線器中。
* 概述：
  * 定義了網路堆疊中的媒體存取控制（MAC）層和物理層（PHY）。
  * Wi-Fi聯盟負責維護和管理基於IEEE 802.11標準的WLAN。
  * 802.11的成功歸因於其接近OSI模型的分層協議堆疊，只需替換MAC層和物理層即可輕鬆使用現有的TCP/IP基礎結構。
  * 早期的802.11安全模型（WEP）被證明不可靠且容易受到攻擊。
    * 現代的Wi-Fi保護存取（WPA）和WPA2使用AES 256位預共享金鑰（PSK）加強了安全性。
* IEEE 802.11協議集：
  * 從最初的802.11基本規範演變而來，已針對各種用例和細分領域進行了特定版本更新，例如：
    * 802.11ac：高速協議，用於WLAN。
    * 802.11ah (HaLow)：明確針對功率和成本受限的物聯網感測器設備，低功率/低頻寬互連。
    * 802.11p：擴展到車聯網和交通運輸物聯網，用於車輛間通信（V2V）。
    * 802.11af：用於電視類比射頻空間的再利用。
    * 802.11ad：用於音視頻的大頻寬近距離通信。
    * 802.11ax：802.11ac的後續標準。
* IEEE 802.11架構：
  * 在2.4 GHz和5 GHz ISM頻段中運作。
  * 位於OSI模型的連結層（第1或2層）。
  * 支援三種基本拓撲結構：
    * 基礎結構基本服務集（BSS）：
      * 站台（STA）
      * 中央存取點（AP）通信的星形拓撲
    * 獨立基本服務集（IBSS）：站台間直接通信的對等（ad hoc）拓撲，沒有存取點。
    * 分佈式系統（DS）：利用存取點組合兩個或多個獨立的BSS網路。
  * IEEE 802.11ah和IEEE 802.11s支援網狀網路拓撲。
  * 一個AP最多可關聯2007個STA。
* IEEE 802.11頻譜分配：
  * 信道間隔約20 MHz，修訂案允許5 MHz和10 MHz信道間隔。
  * 美國802.11b和g最多支援11個信道，非重疊信道為1、6、11。
  * 不同的調變技術（DSSS、OFDM）具有不同的頻譜遮罩。OFDM具有更高的頻譜效率和頻寬。
  * 信道使用受地區和國家法規限制。
* IEEE 802.11調變和編碼技術：
  * 將數位資料轉換為類比訊號進行傳輸。
  * 基本調變方法：
    * 幅移鍵控（ASK）：透過改變訊號幅度來表示資料。
    * 頻移鍵控（FSK）：透過改變載波頻率來表示資料，如藍牙和Z-Wave使用的高斯頻移鍵控（GFSK）。
    * 相移鍵控（PSK）：透過改變載波訊號的相位來表示資料，如802.11b使用的差分相移鍵控（DPSK）。
* 分級調變：
  * 正交振幅調變（QAM）：結合振幅和相位調變，透過星座圖表示編碼，密度越高，吞吐量越高，如16-QAM、64-QAM、256-QAM。
* 干擾緩解技術（展頻技術）：
  * 跳頻展頻（FHSS）：在多個頻段上擴展訊號，透過偽隨機數生成器啟動跳躍過程。
  * 直接序列展頻（DSSS）：將每個位元轉換為多個位元（碼片序列），透過偽隨機數序列擴展訊號到整個頻譜，首次在802.11b中使用。
  * 正交頻分多工（OFDM）：將單個信道分為多個子信道，每個子信道承載資料，使用快速傅立葉變換（FFT）生成OFDM符號，具有更高的頻譜效率。
* IEEE 802.11 MIMO：
  * 多輸入多輸出（MIMO）：利用多徑（訊號反射）現象，透過增加天線數量線性增加信道容量。
  * 形式：
    * 分集：透過多個天線同時傳輸單一資料流，改善訊噪比，提高鏈路可靠性和覆蓋範圍。
    * 空間多工：透過多條路徑承載更多流量，提高資料吞吐能力，將高速率資料流分為多個獨立資料流在不同天線傳輸。
  * 802.11n支援4根天線和4個空間流。
  * 波束成形：可選功能，透過調整訊號的相位和幅度，將訊號聚焦在特定位置，提高訊號強度和範圍。802.11n定義了隱式和顯式反饋兩種方法。
* IEEE 802.11資料包結構：
  * 物理層幀：包括前導碼（用於同步）、PLCP報頭（描述資料包配置和特性）和MPDC MAC資料。
  * MAC幀：
    * 幀控制（FC）字段
      * 協議版本
      * 幀類型
      * DS狀態
      * 更多片段
      * 重發
      * 電源管理
      * 更多資料
      * 加密
      * 嚴格順序模式
    * 持續時間/連接ID
    * 地址
      * DA
      * SA
      * TA
      * RA
    * 序列控制。
  * 幀類型：
    * 管理幀（網路管理、安全、維護）
    * 控制幀（站台間資料交換輔助）
    * 資料幀（資料傳輸主體）。
* IEEE 802.11操作：
  * 掃描：站台連接Wi-Fi的第一階段，包括被動掃描（接收信標和探測請求）和主動掃描（發送探測請求）。
  * 信標：存取點定期廣播的訊息（通常每100毫秒），包含：
    * 網路名稱（SSID）
    * BSSID
    * 信道頻寬
    * 支援信道列表
    * 同步時間（TBTT）
    * 喚醒時間
    * 安全功能（WEP, WPA, WPA2）
  * 同步：使客戶端與存取點保持一致的階段。
  * 認證：如果站台找到要建立連接的AP，進入認證階段。
  * 關聯：安全和身份認證成功後，設備向AP發送關聯請求幀，AP回復關聯響應幀，允許站台加入網路並釋放關聯ID。
* IEEE 802.11安全性：
  * 有線等效加密（WEP）：早期模式，使用純文字金鑰，共享金鑰且金鑰生成弱點導致易受攻擊，現已不建議使用。
  * Wi-Fi保護存取（WPA）：旨在替換WEP，不依賴新硬體，使用暫時金鑰完整性協議（TKIP），每個資料包使用不同金鑰加密，增加了安全性。
  * WPA-PSK（個人模式）：在沒有802.11認證基礎設施的地方，使用口令作為預共享金鑰，但若口令弱則仍有弱點。
  * WPA2：取代WPA，使用進階加密標準（AES）進行加密，比TKIP強得多，採用計數器模式與密碼塊鏈訊息認證碼協議（CCMP）。為了獲得更高的頻寬速率，802.11n必須使用CCMP模式。
* IEEE 802.11ac：
  * 新一代WLAN協議，2013年通過。
  * 目標是實現多站點至少1 Gbit/s和單站點至少500 Mbit/s的吞吐量。
  * 特點：
    * 更寬的信道頻寬（最小80 MHz，最大160 MHz）
    * 8個MIMO空間流
    * 引入下行多用戶MIMO（MU-MIMO）
  * 調變：可選的256-QAM，能夠使用1024-WAM標準化波束成形。
  * 理論上，使用8×8:8設備、160 MHz頻寬和256-QAM調變，單一設備可維持總計6.933 Gbit/s的吞吐量。
* IEEE 802.11p車聯網（VANETs）：
  * 自發且無結構的網路，車輛在城市中移動時與其他車輛和基礎設施交互。
  * 利用車對車（V2V）和車對基礎設施（V2I）模型。
  * 被視為美國運輸部內的專用短程通信（DSRC）信道。
  * 目標是提供標準安全的V2V和V2I系統，用於車輛安全、收費、交通狀態/警告、路邊援助以及車輛內的電子商務。
  * 網路節點：
    * 路邊單元（RSU - 固定位置設備，類似存取點，橋接車輛和移動設備到網路）
    * 車載單元（OBU - 位於車輛中，與其他OBU和RSU通信）
  * 與802.11a的區別：信道頻寬為10 MHz（而非20 MHz），在5.9 GHz空間中運作，支援比特率為802.11a的一半（3-27 Mbit/s），符號持續時間和保護時間間隔為802.11a的兩倍。MIMO和波束成形非必需。
  * 協議堆疊：衍生自802.11a，但使用IEEE 1609.x標準處理應用程式和安全模型，整個堆疊稱為車輛環境中的無線存取（WAVE）。
* IEEE 802.11ah：
  * 也被稱為HaLow，是針對物聯網的無線協議變體，基於802.11ac架構和物理層。
  * 旨在最佳化長電池壽命的受限感測器設備的範圍和頻寬。
  * 特點：
    * 在900 MHz頻譜中運作（有利於傳播和穿透）
    * 信道頻寬可變（2/4/8/16 MHz）
    * 支援多種調變方法（BPSK到256-QAM）
  * 支援單用戶MIMO（SU-MIMO）波束成形。
  * 透過兩種不同的認證方法限制競爭，實現數千個站台的快速關聯。
  * 在單一存取點下提供與數千個設備的連接。
  * 具有中繼功能，可以減少站台的功耗，並允許使用單跳到達的方法生成粗略的網狀網路。
  * 允許在每個802.11ah節點上進行進階電源管理。
  * 使用受限存取窗口（RAW）進行非星形拓撲通信。
  * 透過關聯識別符（AID）分配（13位）實現將數千個設備連接到單一AP的目標（超過8191個STA，而802.11僅支援2007個STA）。
  * 透過刪除與IoT用例無關的字段（如QoS和DS字段）來最佳化MAC報頭長度。
  * 隱式ACK（BD模式）：下一幀的接收意味著先前資料的成功接收，無需交換ACK資料包，節省功耗。
  * RAW：將信道分為多個時隙，每個站台組分配特定時隙，減少衝突，並允許設備進入休眠狀態以節省功耗。
  * 拓撲：
    * 根AP
    * 普通STA
    * 中繼STA（組合AP和STA接口，形成更大網路）。
  * 節能功能：
    * 最大空閒週期值（可允許休眠時間超過五年）
    * TIM分段（信標攜帶位圖的一部分，STA在需要時喚醒接收信標資訊）
    * 目標喚醒時間（TWT）（STA與AP協商商定的喚醒時間，然後進入睡眠狀態）。

# 具有IP的WPAN——6LoWPAN
* 為了解決小型、資源受限設備的IP尋址能力，2005年出現了6LoWPAN的概念。
* 定義：6LoWPAN是「IPv6 over Low-Power Wireless Personal Area Network」的縮寫，旨在透過低功耗射頻通信系統進行IP聯網，適用於功率和空間受限且不需要高頻寬聯網服務的設備。
* 標準：由IETF根據RFC 4944規範設計，並利用RFC 6282（報頭壓縮）和RFC 6775（鄰居發現）解決相關問題。該標準向所有人開放和使用。
* 優點：
  * 最簡單的感測器即可擁有IP尋址能力，並透過3G/4G/LTE/Wi-Fi/乙太網路由器成為網路的一部分。
  * IPv6提供理論上無限的唯一地址（$2^{128}$或$3.4×10^{38}$個），非常適合物聯網的增長。
  * 兼容性：可與其他WPAN通信協議（如802.15.4、藍牙、sub-1 GHz射頻協議和電力線通信（PLC））協同工作。


# 6LoWPAN拓撲
* 6LoWPAN網路是駐留在較大網路外圍的網狀網路。
* 靈活性：
  * 拓撲靈活，可以是臨時和不連續的網路
  * 也可以透過邊緣路由器（邊界路由器）連接到骨幹網或網際網路。
* 多宿主：6LoWPAN網路可以與多個邊緣路由器相連，以實現故障轉移或容錯。
* 邊緣路由器功能：
  * 處理與6LoWPAN設備的通信
  * 將資料中繼到網際網路
  * IPv6報頭壓縮
  * 初始化6LoWPAN網路
  * 在6LoWPAN網路設備之間交換資料
* 節點類型：
  * 路由器：負責安排資料從一個6LoWPAN網狀網節點到另一個，可與外網（WAN）和網際網路通信。
  * 主機：無法在網狀網中按照某條路徑發送資料，僅作為資料生成或消耗的終端，可進入睡眠狀態。
  * 邊緣路由器：通常位於WAN邊緣的閘道和網狀控制器，管理6LoWPAN網狀網。
* 移動性：節點可以在網狀網中自由移動和重組，並在拓撲改變時更改其IPv6地址。
* Ad hoc網狀網：在不需要WAN連接到網際網路的情況下，一個6LoWPAN路由器節點可以管理一個6LoWPAN網狀網。
* 6LoWPAN協議堆疊
  * 6LoWPAN透過在第二層（資料連結層）和第三層（網路層）的頂部提供一個「適配層」來支援IP協議。
  * 此適配層由IETF定義。
  * 在感測器層級啟用IP流量，設備與閘道之間的關係是使用應用層的一些形式將資料從非IP協議轉換為IP協議。
* 網狀網尋址和路由
  * 6LoWPAN網狀網路使用兩種方案進行路由：
    * mesh-under：路由是透明的，假定一個IP子網路代表整個網格。消息在單一域中廣播，並將資料包轉發到堆疊的第二層（資料連結層）。
    * route-over：網路將資料包轉發到堆疊的第三層（網路層），在IP層級管理路由，每個跳點代表一個IP路由器。
  * RPL協議（ripple）：RFC6550定義的路由協議，支援多點對點通信和點對多點通信。
  * 路由表模式：
    * 儲存模式：所有配置為路由器的設備都維護路由表和鄰居表。
    * 非儲存模式：僅單一設備（如邊緣路由器）維護路由表和鄰居表。
  * 跳數、源地址和目標地址字段用於地址解析和路由，跳數在每次資料包從一個節點傳播到另一個節點時遞減。
* 報頭壓縮和分段
  * 為了解決IPv6的MTU大小（1280位元組）與802.15.4的最大限制（127位元組）不兼容以及IPv6報頭長度（40位元組）過大的問題，6LoWPAN採用了報頭壓縮和分段技術。
  * 報頭壓縮：
    * 基於無狀態和共享上下文壓縮，旨在減少IPv6標準報頭中的冗餘。
    * 可將40位元組的IPv6報頭壓縮到2～20位元組之間。
    * 即使在最壞情況下，壓縮也能使流量減少50%。
  * 分段：
    * 將每個IPv6幀分成較小的段，在接收方重新組裝。
    * 類型：
      * 端到端分段：僅在最終目的地重新組裝。
      * 逐跳分段：在網狀網中的每一跳處重新組合。
    * 分段是一項資源密集型任務，建議限制資料大小並使用報頭壓縮。
* 鄰居發現
  * 鄰居發現（ND）由RFC4861定義為單跳路由協議，允許網狀網中的相鄰節點相互通信。
  * 過程：包括鄰居不可達/緩存（NR和NC）和路由器發現（RS和RA）階段。
  * 處理重複地址和不可達鄰居。
  * 序列：
    * 尋找低功耗無線網路的合適連結和子網
    * 最小化控制流量
    * 主機發送RS請求網路前綴
    * 路由器響應前綴
    * 主機分配本地連結單播地址
    * 主機發送該地址到網狀網中的NR消息
    * 執行重複地址檢測（DAD）
* 6LoWPAN安全性
  * 6LoWPAN提供多個級別的安全性。
  * 第二層（802.15.4）：依賴於資料的AES-128加密，並透過CBC-MAC模式（CCM）提供加密和完整性檢查。
  * 第三層（網路層）：可選使用IPsec標準安全性，包括認證報頭（AH，用於完整性保護和認證）和封裝安全負載（ESP，添加加密以保護機密性），ESP模式將AES/CCM重用於第三層加密。
  * 更高層次：利用傳輸層安全性協議（TLS，用於TCP流量）和資料報傳輸層安全性協議（DTLS，用於UDP流量）。
# 具有IP的WPAN——Thread
* Thread是一種基於IPv6的物聯網新型網路協議（6LoWPAN變體），主要目標是實現家庭內各類智慧產品的自動化連接。
* 概述：
  * 由Thread組織聯盟於2014年7月提出。
  * 與Zigbee（同樣基於IEEE 802.15.4協議和6LoWPAN）有共性，但最顯著的區別是Thread支援IP尋址。
  * 基於802.15.4協議的資料層和物理層，具有與6LoWPAN相同的安全和路由功能。
  * 網狀結構，單一網狀網支援多達250個家庭照明系統的控制。
  * 透過最小的感測器啟用IP尋址，可降低功耗和成本，因為不需要一直儲存應用程式狀態。
  * 使用進階加密標準（AES）提供與IPv6兼容的安全選項，所有節點都具有完全加密的傳輸和身份驗證功能。
* Thread架構及拓撲：
  * 基於IEEE 802.15.4-2006協議標準，定義MAC層和PHY層，在GHz頻段以250Kbit/s的速度工作。
  * 透過邊界路由器（通常使用家庭Wi-Fi訊號）與其他設備建立通信。
* 設備角色：
  * 邊界路由器：閘道，將Wi-Fi通信轉接到Thread網路，並形成從Thread網到網際網路的入口點。
  * 引導設備（Leader）：管理註冊表分配各路由器的ID，控制具備路由器資格終端設備（REED）升級為路由器的請求。
  * 路由器資格終端設備（REED）：所有作為主機設備的REED都可以升級為路由器或引導設備，但在被提升前不負責網狀網中的路由轉發。
  * 全功能終端設備（FED）和最小終端設備（MED）：不能升級為路由器的REED類型，MED是休眠狀態的主機設備，僅與其關聯的Thread路由器通信，不能中繼消息。
  * Thread協議堆疊：充分利用6LoWPAN的所有優點（報頭壓縮、IPv6尋址功能、安全增強、分段方案），並增加了距離向量路由和網狀網路連結建立（MLE）兩個組件。
* Thread路由：
  * 在6LoWPAN路由基礎上使用route-over路由。
  * 一個Thread網路中最多允許32個激活路由器。
  * 網狀網路連結建立（MLE）：一種路徑更新演算法，計算從一個路由器到其他路由器的所有路徑，提供識別和配置網狀網中相鄰節點的保護演算法，並透過泛洪網路廣播MLE消息。
  * 路由遍歷基於下一跳路由，所有路由器都儲存網路路由的最新副本。
  * Thread路由器週期性地與鄰近設備交換帶有連結成本資訊的MLE報，強制所有路由器都儲存一個當前路徑列表。
  * 支援測量連結品質，範圍從0（未知成本）到3（良好品質）。
* Thread尋址：
  * 使用16位短地址，低階位決定子地址，高階位決定父地址。
  * 距離向量路由用於在Thread網路中查找路由器的路徑。
  * 所有尋址都是基於UDP的，若需重試則依賴MAC層確認和應用層重發機制。
* 鄰居發現：
  * 入網設備先與路由器聯調，掃描信道並發出信標請求。
  * 若信標包含網路服務集識別符（SSID）和允許加入消息的有效載荷，設備將加入Thread網路。
  * 一旦發現入網設備，MLE消息將廣播以供相鄰路由器確認身份。
  * 提供兩種聯調模式：帶外（使用帶外資料方式）和帶內（使用智慧手機或平板電腦上的調試軟體）。
  * 入網設備與父級路由器透過MLE交換加入網路，並由父級設備分配一個16位的短地址。